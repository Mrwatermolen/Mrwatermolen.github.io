<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="计算算例为： 12345auto domain&amp;#123;std::make_shared&lt;xfdtd::Object&gt;(    &quot;domain&quot;,    std::make_unique&lt;xfdtd::Cube&gt;(xfdtd::Vector&amp;#123;-0.175, -0.175, -0.175&amp;#125;,">
<meta property="og:type" content="article">
<meta property="og:title" content="针对FDTD并行化性能的分析报告">
<meta property="og:url" content="http://example.com/2024/09/28/%E9%92%88%E5%AF%B9FDTD%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/index.html">
<meta property="og:site_name" content="MH&#39;s Blog">
<meta property="og:description" content="计算算例为： 12345auto domain&amp;#123;std::make_shared&lt;xfdtd::Object&gt;(    &quot;domain&quot;,    std::make_unique&lt;xfdtd::Cube&gt;(xfdtd::Vector&amp;#123;-0.175, -0.175, -0.175&amp;#125;,">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-09-28T09:15:39.000Z">
<meta property="article:modified_time" content="2024-09-28T09:16:21.861Z">
<meta property="article:author" content="MH">
<meta property="article:tag" content="并行计算">
<meta property="article:tag" content="性能分析">
<meta property="article:tag" content="benchmark">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2024/09/28/%E9%92%88%E5%AF%B9FDTD%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>针对FDTD并行化性能的分析报告 | MH's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MH's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">57</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">17</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">60</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/28/%E9%92%88%E5%AF%B9FDTD%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s2.loli.net/2022/03/16/Gohs3aZKxyScgvL.png">
      <meta itemprop="name" content="MH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MH's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          针对FDTD并行化性能的分析报告
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-09-28 17:15:39 / 修改时间：17:16:21" itemprop="dateCreated datePublished" datetime="2024-09-28T17:15:39+08:00">2024-09-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FDTD/" itemprop="url" rel="index"><span itemprop="name">FDTD</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>计算算例为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> domain&#123;<span class="built_in">std</span>::make_shared&lt;xfdtd::Object&gt;(</span><br><span class="line">    <span class="string">&quot;domain&quot;</span>,</span><br><span class="line">    <span class="built_in">std</span>::make_unique&lt;xfdtd::Cube&gt;(xfdtd::Vector&#123;<span class="number">-0.175</span>, <span class="number">-0.175</span>, <span class="number">-0.175</span>&#125;,</span><br><span class="line">                                  xfdtd::Vector&#123;<span class="number">0.35</span>, <span class="number">0.35</span>, <span class="number">0.35</span>&#125;),</span><br><span class="line">    xfdtd::Material::createAir())&#125;;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>测试平台</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">                          .&#x2F;+o+-       franzero@franzero-MS-7C94</span><br><span class="line">                  yyyyy- -yyyyyy+      OS: Ubuntu 24.04 noble</span><br><span class="line">               :&#x2F;&#x2F;+&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;-yyyyyyo      Kernel: x86_64 Linux 6.8.0-45-generic</span><br><span class="line">           .++ .:&#x2F;++++++&#x2F;-.+sss&#x2F;&#96;      Uptime: 6h 29m</span><br><span class="line">         .:++o:  &#x2F;++++++++&#x2F;:--:&#x2F;-      Packages: 2282</span><br><span class="line">        o:+o+:++.&#96;..&#96;&#96;&#96;.-&#x2F;oo+++++&#x2F;     Shell: zsh 5.9</span><br><span class="line">       .:+o:+o&#x2F;.          &#96;+sssoo+&#x2F;    Disk: 616G &#x2F; 6.3T (11%)</span><br><span class="line">  .++&#x2F;+:+oo+o:&#96;             &#x2F;sssooo.   CPU: AMD Ryzen 5 5600X 6-Core @ 12x 3.7GHz</span><br><span class="line"> &#x2F;+++&#x2F;&#x2F;+:&#96;oo+o               &#x2F;::--:.   RAM: 3630MiB &#x2F; 15909MiB</span><br><span class="line"> \+&#x2F;+o+++&#96;o++o               ++&#x2F;&#x2F;&#x2F;&#x2F;.   </span><br><span class="line">  .++.o+++oo+:&#96;             &#x2F;dddhhh.  </span><br><span class="line">       .+.o+oo:.          &#96;oddhhhh+   </span><br><span class="line">        \+.++o+o&#96;&#96;-&#96;&#96;&#96;&#96;.:ohdhhhhh+    </span><br><span class="line">         &#96;:o+++ &#96;ohhhhhhhhyo++os:     </span><br><span class="line">           .o:&#96;.syhhhhhhh&#x2F;.oo++o&#96;     </span><br><span class="line">               &#x2F;osyyyyyyo++ooo+++&#x2F;    </span><br><span class="line">                   &#96;&#96;&#96;&#96;&#96; +oo+++o\:    </span><br><span class="line">                          &#96;oo++. </span><br><span class="line"></span><br><span class="line">Architecture:             x86_64</span><br><span class="line">  CPU op-mode(s):         32-bit, 64-bit</span><br><span class="line">  Address sizes:          48 bits physical, 48 bits virtual</span><br><span class="line">  Byte Order:             Little Endian</span><br><span class="line">CPU(s):                   12</span><br><span class="line">  On-line CPU(s) list:    0-11</span><br><span class="line">Vendor ID:                AuthenticAMD</span><br><span class="line">  Model name:             AMD Ryzen 5 5600X 6-Core Processor</span><br><span class="line">    CPU family:           25</span><br><span class="line">    Model:                33</span><br><span class="line">    Thread(s) per core:   2</span><br><span class="line">    Core(s) per socket:   6</span><br><span class="line">    Socket(s):            1</span><br><span class="line">    Stepping:             0</span><br><span class="line">    Frequency boost:      enabled</span><br><span class="line">    CPU(s) scaling MHz:   57%</span><br><span class="line">    CPU max MHz:          4650.2920</span><br><span class="line">    CPU min MHz:          2200.0000</span><br></pre></td></tr></table></figure>
<p>Stat报告：<code>sudo perf stat -e task-clock,cycles,instructions,cache-references,cache-misses,branches,branch-misses,page-faults,minor-faults,major-faultscpu-migrations,context-switche</code></p>
<h2 id="1-无PML边界时"><a href="#1-无PML边界时" class="headerlink" title="1. 无PML边界时"></a>1. 无PML边界时</h2><p>整个计算域大小为70x70x70。时间步长为1200</p>
<p>串行命令：<code>./build/Release-x64/bin/benchmark -t 1200 -t_c 1 1 1</code></p>
<p>报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 1 1 1&#39;:</span><br><span class="line"></span><br><span class="line">         4,676.22 msec task-clock                       #    0.942 CPUs utilized             </span><br><span class="line">   20,922,169,997      cycles                           #    4.474 GHz                         (83.38%)</span><br><span class="line">   82,578,031,208      instructions                     #    3.95  insn per cycle              (83.36%)</span><br><span class="line">    4,229,791,865      cache-references                 #  904.532 M&#x2F;sec                       (83.26%)</span><br><span class="line">      102,750,093      cache-misses                     #    2.43% of all cache refs           (83.22%)</span><br><span class="line">    2,996,821,632      branches                         #  640.864 M&#x2F;sec                       (83.40%)</span><br><span class="line">       14,714,284      branch-misses                    #    0.49% of all branches             (83.38%)</span><br><span class="line">           40,282      page-faults                      #    8.614 K&#x2F;sec                     </span><br><span class="line">           40,279      minor-faults                     #    8.614 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.642 &#x2F;sec                      </span><br><span class="line">               51      cpu-migrations                   #   10.804 &#x2F;sec                      </span><br><span class="line">            3,125      context-switches                 #  661.987 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">      4.964122624 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      4.520302000 seconds user</span><br><span class="line">      0.099006000 seconds sys</span><br></pre></td></tr></table></figure>
<h3 id="多线程性能分析"><a href="#多线程性能分析" class="headerlink" title="多线程性能分析"></a>多线程性能分析</h3><p>XFDTD已经将线程绑定到CPU核心，0号线程绑定到0号核心，1号线程绑定到1号核心。</p>
<p>2x1x1: <code>./build/Release-x64/bin/benchmark -t 1200 -t_c 2 1 1</code></p>
<p>报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 2 1 1&#39;:</span><br><span class="line"></span><br><span class="line">         5,010.83 msec task-clock                       #    1.676 CPUs utilized             </span><br><span class="line">   22,380,340,770      cycles                           #    4.466 GHz                         (83.36%)</span><br><span class="line">   82,709,456,232      instructions                     #    3.70  insn per cycle              (83.19%)</span><br><span class="line">    4,270,380,181      cache-references                 #  852.231 M&#x2F;sec                       (83.29%)</span><br><span class="line">      108,694,744      cache-misses                     #    2.55% of all cache refs           (83.41%)</span><br><span class="line">    3,032,116,421      branches                         #  605.113 M&#x2F;sec                       (83.29%)</span><br><span class="line">       19,110,567      branch-misses                    #    0.63% of all branches             (83.46%)</span><br><span class="line">           40,303      page-faults                      #    8.043 K&#x2F;sec                     </span><br><span class="line">           40,300      minor-faults                     #    8.043 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.599 &#x2F;sec                      </span><br><span class="line">               63      cpu-migrations                   #   12.451 &#x2F;sec                      </span><br><span class="line">            9,973      context-switches                 #    1.971 K&#x2F;sec                     </span><br><span class="line"></span><br><span class="line">      2.989421301 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      4.741480000 seconds user</span><br><span class="line">      0.201530000 seconds sys</span><br></pre></td></tr></table></figure>
<p>加速比为：4.96/2.99 = 1.66</p>
<p>多线程比单线程快了：（4.96-2.99）/4.96 = 39.72%</p>
<p>多线程的CPU利用率为：167.6%</p>
<p>在Stat报告中，2x1x1的分支预测错误率和缓存未命中率获得了与串行执行差不多的结果。加速比没有达到2，可能是CPU利用率不够高，也许是因为过多的上下文切换。</p>
<p>1x2x1: <code>./build/Release-x64/bin/benchmark -t 1200 -t_c 1 2 1</code></p>
<p>报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 1 2 1&#39;:</span><br><span class="line"></span><br><span class="line">         5,252.76 msec task-clock                       #    1.687 CPUs utilized             </span><br><span class="line">   23,275,116,991      cycles                           #    4.431 GHz                         (83.29%)</span><br><span class="line">   82,704,202,147      instructions                     #    3.55  insn per cycle              (83.35%)</span><br><span class="line">    4,554,703,918      cache-references                 #  867.107 M&#x2F;sec                       (83.47%)</span><br><span class="line">      258,114,565      cache-misses                     #    5.67% of all cache refs           (83.11%)</span><br><span class="line">    3,034,010,364      branches                         #  577.603 M&#x2F;sec                       (83.33%)</span><br><span class="line">       19,516,081      branch-misses                    #    0.64% of all branches             (83.47%)</span><br><span class="line">           40,297      page-faults                      #    7.672 K&#x2F;sec                     </span><br><span class="line">           40,294      minor-faults                     #    7.671 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.571 &#x2F;sec                      </span><br><span class="line">               64      cpu-migrations                   #   12.297 &#x2F;sec                      </span><br><span class="line">            8,633      context-switches                 #    1.659 K&#x2F;sec                     </span><br><span class="line"></span><br><span class="line">      3.113548404 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      5.030267000 seconds user</span><br><span class="line">      0.153733000 seconds sys</span><br></pre></td></tr></table></figure>
<p>加速比为：4.96/3.11 = 1.59</p>
<p>多线程比单线程快了：（4.96-3.11）/4.96 = 37.30%</p>
<p>多线程的CPU利用率为：168.7%</p>
<p>1x2x1相比于2x1x1，在Stat报告中，缓存的未命中率有所增加，几乎是2x1x1或者串行的两倍。导致在CPU利用率相同与2x1x1差不多的情况下，加速效果没有2x1x1好。</p>
<p>1x1x2: <code>./build/Release-x64/bin/benchmark -t 1200 -t_c 1 1 2</code></p>
<p>报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 1 1 2&#39;:</span><br><span class="line"></span><br><span class="line">         7,140.03 msec task-clock                       #    1.774 CPUs utilized             </span><br><span class="line">   32,256,025,684      cycles                           #    4.518 GHz                         (83.31%)</span><br><span class="line">   83,803,187,755      instructions                     #    2.60  insn per cycle              (83.26%)</span><br><span class="line">    8,364,234,889      cache-references                 #    1.171 G&#x2F;sec                       (83.36%)</span><br><span class="line">      311,977,954      cache-misses                     #    3.73% of all cache refs           (83.37%)</span><br><span class="line">    3,089,285,740      branches                         #  432.671 M&#x2F;sec                       (83.31%)</span><br><span class="line">       18,422,341      branch-misses                    #    0.60% of all branches             (83.38%)</span><br><span class="line">           40,290      page-faults                      #    5.643 K&#x2F;sec                     </span><br><span class="line">           40,287      minor-faults                     #    5.642 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.420 &#x2F;sec                      </span><br><span class="line">               56      cpu-migrations                   #    7.778 &#x2F;sec                      </span><br><span class="line">            5,309      context-switches                 #  737.412 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">      4.024689262 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      6.935281000 seconds user</span><br><span class="line">      0.136749000 seconds sys</span><br></pre></td></tr></table></figure>
<p>加速比为：4.96/4.02 = 1.23</p>
<p>多线程比单线程快了：（4.96-4.02）/4.96 = 18.95%</p>
<p>多线程的CPU利用率为：177.4%</p>
<p>1x1x2的性能几乎是最差的，最高的CPU利用率，却获得了最差的加速比。从报告中可以看到，缓存未命中率是虽然为3.73%，但是缓存引用次数是最高的，达到了80亿次，是其他的两倍。</p>
<p>原因： 3维数组的存储是行优先，索引按x,y,z顺序获取，即在z方向上是连续的。1x1x2的划分，切断了z方向上的连续性，缓存的引用次数增加。</p>
<p>在FDTD程序中占用大量时间的是Update函数，里面有一个三重for循环，按x,y,z的顺序遍历</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = is; x &lt; ie; ++x) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> y = js; y &lt; je; ++y) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> z = ks; z &lt; ke; ++z) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>某次循环中，加载到缓存的数据为<code>[x_i, y_i, z_i], [x_i, y_i, z_i+1], [x_i, y_i, z_i+2]</code>，在1x1x2的划分下，访问到<code>[x_i, y_i, z_i+1]</code>时，z方向上的循化结束，下一次访问<code>[x_i, y_i+1, z_i]</code>时，z方向上的数据不在缓存中，需要重新加载。1x1x2划分会多次出现这样的情形，大约会是<code>nx*ny</code>次。</p>
<blockquote>
<p>PS:在FDTD中多重for循环的分支预测错误却不是主要的性能瓶颈。</p>
</blockquote>
<h3 id="多进程性能分析"><a href="#多进程性能分析" class="headerlink" title="多进程性能分析"></a>多进程性能分析</h3><p>2x1x1: <code>mpiexec --allow-run-as-root --bind-to core  -n 2  ./build/Release-x64/bin/benchmark -t 1200 -t_c 1 1 1</code></p>
<p>报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;mpiexec --allow-run-as-root --bind-to core -n 2 .&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 1 1 1&#39;:</span><br><span class="line"></span><br><span class="line">         5,260.68 msec task-clock                       #    1.797 CPUs utilized             </span><br><span class="line">   23,443,996,940      cycles                           #    4.456 GHz                         (83.07%)</span><br><span class="line">   86,076,787,999      instructions                     #    3.67  insn per cycle              (83.40%)</span><br><span class="line">    4,404,421,901      cache-references                 #  837.235 M&#x2F;sec                       (83.42%)</span><br><span class="line">      112,032,269      cache-misses                     #    2.54% of all cache refs           (83.25%)</span><br><span class="line">    3,371,057,675      branches                         #  640.803 M&#x2F;sec                       (83.43%)</span><br><span class="line">       21,297,282      branch-misses                    #    0.63% of all branches             (83.44%)</span><br><span class="line">           44,539      page-faults                      #    8.466 K&#x2F;sec                     </span><br><span class="line">           44,535      minor-faults                     #    8.466 K&#x2F;sec                     </span><br><span class="line">                4      major-faults                     #    0.760 &#x2F;sec                      </span><br><span class="line">              136      cpu-migrations                   #   25.852 &#x2F;sec                      </span><br><span class="line">            6,136      context-switches                 #    1.166 K&#x2F;sec                     </span><br><span class="line"></span><br><span class="line">      2.926716656 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      5.015942000 seconds user</span><br><span class="line">      0.233263000 seconds sys</span><br></pre></td></tr></table></figure>
<p>1x1x2: <code>mpiexec --allow-run-as-root --bind-to core  -n 2  ./build/Release-x64/bin/benchmark -t 1200 -t_c 1 1 1</code></p>
<p>报告如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;mpiexec --allow-run-as-root --bind-to core -n 2 .&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 1 1 1&#39;:</span><br><span class="line"></span><br><span class="line">         5,401.87 msec task-clock                       #    1.802 CPUs utilized             </span><br><span class="line">   24,066,472,199      cycles                           #    4.455 GHz                         (83.29%)</span><br><span class="line">   88,250,212,639      instructions                     #    3.67  insn per cycle              (83.34%)</span><br><span class="line">    4,487,750,246      cache-references                 #  830.778 M&#x2F;sec                       (83.39%)</span><br><span class="line">      145,999,530      cache-misses                     #    3.25% of all cache refs           (83.28%)</span><br><span class="line">    3,748,377,075      branches                         #  693.904 M&#x2F;sec                       (83.40%)</span><br><span class="line">       20,100,212      branch-misses                    #    0.54% of all branches             (83.30%)</span><br><span class="line">           44,628      page-faults                      #    8.262 K&#x2F;sec                     </span><br><span class="line">           44,624      minor-faults                     #    8.261 K&#x2F;sec                     </span><br><span class="line">                4      major-faults                     #    0.740 &#x2F;sec                      </span><br><span class="line">              122      cpu-migrations                   #   22.585 &#x2F;sec                      </span><br><span class="line">            6,166      context-switches                 #    1.141 K&#x2F;sec                     </span><br><span class="line"></span><br><span class="line">      2.997049471 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      5.182734000 seconds user</span><br><span class="line">      0.208839000 seconds sys</span><br></pre></td></tr></table></figure></p>
<p>不受空间划分影响，多进程的性能表现与多线程的性能表现差不多。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>多线程在最佳情况下和多进程的性能表现差不多。</p>
<h2 id="2-有PML边界时"><a href="#2-有PML边界时" class="headerlink" title="2. 有PML边界时"></a>2. 有PML边界时</h2><p>整个计算域大小为86x86x86。时间步长为1200。PML边界层数为8。</p>
<p>串行命令：<code>./build/Release-x64/bin/benchmark --with_pml -t 1200 -t_c 1 1 1</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark --with_pml -t 1200 -t_c 1 1 1&#39;:</span><br><span class="line"></span><br><span class="line">        12,992.83 msec task-clock                       #    0.977 CPUs utilized             </span><br><span class="line">   58,734,301,508      cycles                           #    4.521 GHz                         (83.36%)</span><br><span class="line">  203,700,658,783      instructions                     #    3.47  insn per cycle              (83.29%)</span><br><span class="line">    9,971,769,749      cache-references                 #  767.483 M&#x2F;sec                       (83.34%)</span><br><span class="line">      525,622,296      cache-misses                     #    5.27% of all cache refs           (83.35%)</span><br><span class="line">    7,340,039,091      branches                         #  564.930 M&#x2F;sec                       (83.35%)</span><br><span class="line">       31,616,197      branch-misses                    #    0.43% of all branches             (83.30%)</span><br><span class="line">           76,039      page-faults                      #    5.852 K&#x2F;sec                     </span><br><span class="line">           76,036      minor-faults                     #    5.852 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.231 &#x2F;sec                      </span><br><span class="line">               58      cpu-migrations                   #    4.464 &#x2F;sec                      </span><br><span class="line">            6,443      context-switches                 #  495.889 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">     13.294737831 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     12.758390000 seconds user</span><br><span class="line">      0.164669000 seconds sys</span><br></pre></td></tr></table></figure>
<h3 id="多线程性能分析-1"><a href="#多线程性能分析-1" class="headerlink" title="多线程性能分析"></a>多线程性能分析</h3><p>XFDTD已经将线程绑定到CPU核心，0号线程绑定到0号核心，1号线程绑定到1号核心。</p>
<p>2x1x1: <code>./build/Release-x64/bin/benchmark --with_pml -t 1200 -t_c 2 1 1</code></p>
<p>报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark --with_pml -t 1200 -t_c 2 1 1&#39;:</span><br><span class="line"></span><br><span class="line">        14,354.55 msec task-clock                       #    1.845 CPUs utilized             </span><br><span class="line">   64,710,649,907      cycles                           #    4.508 GHz                         (83.34%)</span><br><span class="line">  204,088,834,355      instructions                     #    3.15  insn per cycle              (83.40%)</span><br><span class="line">    9,999,684,154      cache-references                 #  696.621 M&#x2F;sec                       (83.28%)</span><br><span class="line">      539,018,362      cache-misses                     #    5.39% of all cache refs           (83.38%)</span><br><span class="line">    7,374,690,193      branches                         #  513.753 M&#x2F;sec                       (83.31%)</span><br><span class="line">       36,375,992      branch-misses                    #    0.49% of all branches             (83.28%)</span><br><span class="line">           76,027      page-faults                      #    5.296 K&#x2F;sec                     </span><br><span class="line">           76,024      minor-faults                     #    5.296 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.209 &#x2F;sec                      </span><br><span class="line">               57      cpu-migrations                   #    3.971 &#x2F;sec                      </span><br><span class="line">           13,435      context-switches                 #  935.940 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">      7.778543962 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     14.035339000 seconds user</span><br><span class="line">      0.240954000 seconds sys</span><br></pre></td></tr></table></figure>
<p>1x1x2: <code>./build/Release-x64/bin/benchmark --with_pml -t 1200 -t_c 1 1 2</code></p>
<p>报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark --with_pml -t 1200 -t_c 1 1 2&#39;:</span><br><span class="line"></span><br><span class="line">        25,672.21 msec task-clock                       #    1.917 CPUs utilized             </span><br><span class="line">  116,805,723,909      cycles                           #    4.550 GHz                         (83.33%)</span><br><span class="line">  205,888,912,957      instructions                     #    1.76  insn per cycle              (83.34%)</span><br><span class="line">   19,328,422,246      cache-references                 #  752.893 M&#x2F;sec                       (83.34%)</span><br><span class="line">    1,145,169,180      cache-misses                     #    5.92% of all cache refs           (83.32%)</span><br><span class="line">    7,512,461,061      branches                         #  292.630 M&#x2F;sec                       (83.32%)</span><br><span class="line">       61,675,797      branch-misses                    #    0.82% of all branches             (83.35%)</span><br><span class="line">           76,035      page-faults                      #    2.962 K&#x2F;sec                     </span><br><span class="line">           76,032      minor-faults                     #    2.962 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.117 &#x2F;sec                      </span><br><span class="line">               63      cpu-migrations                   #    2.454 &#x2F;sec                      </span><br><span class="line">           12,918      context-switches                 #  503.190 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">     13.393647514 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     25.365368000 seconds user</span><br><span class="line">      0.215383000 seconds sys</span><br></pre></td></tr></table></figure>
<p>1x1x2的加速效果极差，在最高的CPU利用率下，速度和串行执行差不多。缓存引用次数和分支次数都是最高的。</p>
<h3 id="多进程性能分析-1"><a href="#多进程性能分析-1" class="headerlink" title="多进程性能分析"></a>多进程性能分析</h3><p><code>mpiexec --allow-run-as-root --bind-to core  -n 2  ./build/Release-x64/bin/benchmark --with_pml  -t 1200 -t_c 1 1 1</code></p>
<p>1x1x2报告如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;mpiexec --allow-run-as-root --bind-to core -n 2 .&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark --with_pml -t 1200 -t_c 1 1 1&#39;:</span><br><span class="line"></span><br><span class="line">        15,365.46 msec task-clock                       #    1.925 CPUs utilized             </span><br><span class="line">   69,081,113,395      cycles                           #    4.496 GHz                         (83.32%)</span><br><span class="line">  213,563,002,414      instructions                     #    3.09  insn per cycle              (83.33%)</span><br><span class="line">   10,682,103,857      cache-references                 #  695.202 M&#x2F;sec                       (83.34%)</span><br><span class="line">      645,525,024      cache-misses                     #    6.04% of all cache refs           (83.36%)</span><br><span class="line">    8,511,543,167      branches                         #  553.940 M&#x2F;sec                       (83.39%)</span><br><span class="line">       45,406,924      branch-misses                    #    0.53% of all branches             (83.26%)</span><br><span class="line">           81,154      page-faults                      #    5.282 K&#x2F;sec                     </span><br><span class="line">           81,151      minor-faults                     #    5.281 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.195 &#x2F;sec                      </span><br><span class="line">              308      cpu-migrations                   #   20.045 &#x2F;sec                      </span><br><span class="line">            9,800      context-switches                 #  637.794 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">      7.980754877 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     15.049898000 seconds user</span><br><span class="line">      0.298889000 seconds sys</span><br></pre></td></tr></table></figure>
<p>2x1x1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;mpiexec --allow-run-as-root --bind-to core -n 2 .&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark --with_pml -t 1200 -t_c 1 1 1&#39;:</span><br><span class="line"></span><br><span class="line">        14,956.17 msec task-clock                       #    1.924 CPUs utilized             </span><br><span class="line">   67,179,684,611      cycles                           #    4.492 GHz                         (83.32%)</span><br><span class="line">  208,882,939,244      instructions                     #    3.11  insn per cycle              (83.42%)</span><br><span class="line">   10,231,637,604      cache-references                 #  684.108 M&#x2F;sec                       (83.35%)</span><br><span class="line">      549,804,692      cache-misses                     #    5.37% of all cache refs           (83.31%)</span><br><span class="line">    7,747,500,546      branches                         #  518.014 M&#x2F;sec                       (83.31%)</span><br><span class="line">       39,120,745      branch-misses                    #    0.50% of all branches             (83.29%)</span><br><span class="line">           81,026      page-faults                      #    5.418 K&#x2F;sec                     </span><br><span class="line">           81,023      minor-faults                     #    5.417 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.201 &#x2F;sec                      </span><br><span class="line">              232      cpu-migrations                   #   15.512 &#x2F;sec                      </span><br><span class="line">            9,647      context-switches                 #  645.018 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">      7.771637133 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     14.583200000 seconds user</span><br><span class="line">      0.356060000 seconds sys</span><br></pre></td></tr></table></figure>
<h2 id="更大并行度"><a href="#更大并行度" class="headerlink" title="更大并行度"></a>更大并行度</h2><p>多线程4x1x1: <code>./build/Release-x64/bin/benchmark -t 1200 -t_c 4 1 1</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 4 1 1&#39;:</span><br><span class="line"></span><br><span class="line">         6,700.63 msec task-clock                       #    2.954 CPUs utilized             </span><br><span class="line">   29,755,851,505      cycles                           #    4.441 GHz                         (83.51%)</span><br><span class="line">   83,205,528,265      instructions                     #    2.80  insn per cycle              (83.10%)</span><br><span class="line">    4,199,090,239      cache-references                 #  626.671 M&#x2F;sec                       (83.31%)</span><br><span class="line">       93,311,424      cache-misses                     #    2.22% of all cache refs           (83.27%)</span><br><span class="line">    3,088,270,961      branches                         #  460.893 M&#x2F;sec                       (83.47%)</span><br><span class="line">       26,095,146      branch-misses                    #    0.84% of all branches             (83.34%)</span><br><span class="line">           40,295      page-faults                      #    6.014 K&#x2F;sec                     </span><br><span class="line">           40,292      minor-faults                     #    6.013 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.448 &#x2F;sec                      </span><br><span class="line">               64      cpu-migrations                   #    9.551 &#x2F;sec                      </span><br><span class="line">           22,750      context-switches                 #    3.395 K&#x2F;sec                     </span><br><span class="line"></span><br><span class="line">      2.268141292 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      6.323666000 seconds user</span><br><span class="line">      0.291030000 seconds sys</span><br></pre></td></tr></table></figure>
<p>多线程1x1x4: <code>./build/Release-x64/bin/benchmark -t 1200 -t_c 1 1 4</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 1 1 4&#39;:</span><br><span class="line"></span><br><span class="line">        14,000.02 msec task-clock                       #    3.473 CPUs utilized             </span><br><span class="line">   63,236,927,938      cycles                           #    4.517 GHz                         (83.28%)</span><br><span class="line">   86,178,188,140      instructions                     #    1.36  insn per cycle              (83.34%)</span><br><span class="line">   14,446,451,610      cache-references                 #    1.032 G&#x2F;sec                       (83.39%)</span><br><span class="line">      683,928,113      cache-misses                     #    4.73% of all cache refs           (83.37%)</span><br><span class="line">    3,274,725,625      branches                         #  233.909 M&#x2F;sec                       (83.33%)</span><br><span class="line">       27,821,046      branch-misses                    #    0.85% of all branches             (83.29%)</span><br><span class="line">           40,298      page-faults                      #    2.878 K&#x2F;sec                     </span><br><span class="line">           40,295      minor-faults                     #    2.878 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.214 &#x2F;sec                      </span><br><span class="line">               65      cpu-migrations                   #    4.643 &#x2F;sec                      </span><br><span class="line">           11,451      context-switches                 #  817.928 &#x2F;sec                      </span><br><span class="line"></span><br><span class="line">      4.030696660 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     13.727729000 seconds user</span><br><span class="line">      0.188187000 seconds sys</span><br></pre></td></tr></table></figure>
<p>多线程2x2x1: <code>&#39;./build/Release-x64/bin/benchmark -t 1200 -t_c 2 2 1</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 2 2 1&#39;:</span><br><span class="line"></span><br><span class="line">         7,203.20 msec task-clock                       #    3.054 CPUs utilized             </span><br><span class="line">   32,083,910,773      cycles                           #    4.454 GHz                         (83.21%)</span><br><span class="line">   82,976,776,310      instructions                     #    2.59  insn per cycle              (83.38%)</span><br><span class="line">    4,303,902,243      cache-references                 #  597.499 M&#x2F;sec                       (83.26%)</span><br><span class="line">      157,530,568      cache-misses                     #    3.66% of all cache refs           (83.28%)</span><br><span class="line">    3,099,766,338      branches                         #  430.332 M&#x2F;sec                       (83.38%)</span><br><span class="line">       26,860,431      branch-misses                    #    0.87% of all branches             (83.49%)</span><br><span class="line">           40,318      page-faults                      #    5.597 K&#x2F;sec                     </span><br><span class="line">           40,315      minor-faults                     #    5.597 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.416 &#x2F;sec                      </span><br><span class="line">               63      cpu-migrations                   #    8.746 &#x2F;sec                      </span><br><span class="line">           22,403      context-switches                 #    3.110 K&#x2F;sec                     </span><br><span class="line"></span><br><span class="line">      2.358286286 seconds time elapsed</span><br><span class="line"></span><br><span class="line">      6.834764000 seconds user</span><br><span class="line">      0.283820000 seconds sys</span><br></pre></td></tr></table></figure>
<p>多线程1x2x2: <code>./build/Release-x64/bin/benchmark -t 1200 -t_c 1 2 2</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#39;.&#x2F;build&#x2F;Release-x64&#x2F;bin&#x2F;benchmark -t 1200 -t_c 1 2 2&#39;:</span><br><span class="line"></span><br><span class="line">        14,890.42 msec task-clock                       #    3.480 CPUs utilized             </span><br><span class="line">   67,470,192,018      cycles                           #    4.531 GHz                         (83.39%)</span><br><span class="line">   84,160,170,749      instructions                     #    1.25  insn per cycle              (83.28%)</span><br><span class="line">    7,447,985,604      cache-references                 #  500.186 M&#x2F;sec                       (83.34%)</span><br><span class="line">    1,035,847,953      cache-misses                     #   13.91% of all cache refs           (83.29%)</span><br><span class="line">    3,165,261,031      branches                         #  212.570 M&#x2F;sec                       (83.37%)</span><br><span class="line">       29,836,493      branch-misses                    #    0.94% of all branches             (83.34%)</span><br><span class="line">           40,295      page-faults                      #    2.706 K&#x2F;sec                     </span><br><span class="line">           40,292      minor-faults                     #    2.706 K&#x2F;sec                     </span><br><span class="line">                3      major-faults                     #    0.201 &#x2F;sec                      </span><br><span class="line">               57      cpu-migrations                   #    3.828 &#x2F;sec                      </span><br><span class="line">           20,126      context-switches                 #    1.352 K&#x2F;sec                     </span><br><span class="line"></span><br><span class="line">      4.278950130 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     14.502632000 seconds user</span><br><span class="line">      0.288415000 seconds sys</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97/" rel="tag"># 并行计算</a>
              <a href="/tags/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" rel="tag"># 性能分析</a>
              <a href="/tags/benchmark/" rel="tag"># benchmark</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/05/16/%E8%AE%B0%E9%A6%96%E6%AC%A1%E7%BC%96%E5%86%99CPP%E5%BA%93%E6%89%80%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" rel="prev" title="记首次编写CPP库所遇到的问题">
      <i class="fa fa-chevron-left"></i> 记首次编写CPP库所遇到的问题
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%97%A0PML%E8%BE%B9%E7%95%8C%E6%97%B6"><span class="nav-text">1. 无PML边界时</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-text">多线程性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-text">多进程性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%9C%89PML%E8%BE%B9%E7%95%8C%E6%97%B6"><span class="nav-text">2. 有PML边界时</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90-1"><span class="nav-text">多线程性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90-1"><span class="nav-text">多进程性能分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E5%A4%A7%E5%B9%B6%E8%A1%8C%E5%BA%A6"><span class="nav-text">更大并行度</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="MH"
      src="https://s2.loli.net/2022/03/16/Gohs3aZKxyScgvL.png">
  <p class="site-author-name" itemprop="name">MH</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Mrwatermolen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Mrwatermolen" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MH</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

  

</body>
</html>
